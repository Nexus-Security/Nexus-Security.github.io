<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kang Asu
Pyrdp - RDP Man-In-The-Middle And Library For Python3 With The Ability To Watch Connections Live Or After The Fact
PyRDP is a Python 3¬†Remote Desktop Protocol¬†(RDP)¬†Man-in-the-Middle¬†(MITM) and library.
It features a few tools:
RDP Man-in-the-Middle Logs¬†credentials¬†used when connecting Steals data copied to the clipboard Saves a copy of the files transferred over the network Saves replays of connections so you can look at them later Run console commands or¬†PowerShell¬†payloads automatically on new connections RDP Player: See live RDP connections coming from the MITM View replays of RDP connections Take control of active RDP sessions while hiding your actions List the client&amp;rsquo;s mapped drives and download files from them during active sessions RDP Certificate Cloner: Create a self-signed X509 certificate with the same fields as an RDP server&amp;rsquo;s certificate We have used this tool as part of an RDP honeypot which records sessions and saves a copy of the malware dropped on our target machine."><title>Be Mobile Theme v1.5 ‚Äì Mobile WordPress Theme</title><link rel=canonical href=https://Nexus-Security.github.io/posts/2016-09-09-be-mobile-theme-v15-mobile-wordpress_25/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property="og:title" content="Be Mobile Theme v1.5 ‚Äì Mobile WordPress Theme"><meta property="og:description" content="Kang Asu
Pyrdp - RDP Man-In-The-Middle And Library For Python3 With The Ability To Watch Connections Live Or After The Fact
PyRDP is a Python 3¬†Remote Desktop Protocol¬†(RDP)¬†Man-in-the-Middle¬†(MITM) and library.
It features a few tools:
RDP Man-in-the-Middle Logs¬†credentials¬†used when connecting Steals data copied to the clipboard Saves a copy of the files transferred over the network Saves replays of connections so you can look at them later Run console commands or¬†PowerShell¬†payloads automatically on new connections RDP Player: See live RDP connections coming from the MITM View replays of RDP connections Take control of active RDP sessions while hiding your actions List the client&amp;rsquo;s mapped drives and download files from them during active sessions RDP Certificate Cloner: Create a self-signed X509 certificate with the same fields as an RDP server&amp;rsquo;s certificate We have used this tool as part of an RDP honeypot which records sessions and saves a copy of the malware dropped on our target machine."><meta property="og:url" content="https://Nexus-Security.github.io/posts/2016-09-09-be-mobile-theme-v15-mobile-wordpress_25/"><meta property="og:site_name" content="ZYChimne"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:published_time" content="2019-09-26T06:49:00+01:00"><meta property="article:modified_time" content="2019-09-26T06:49:00+01:00"><meta name=twitter:title content="Be Mobile Theme v1.5 ‚Äì Mobile WordPress Theme"><meta name=twitter:description content="Kang Asu
Pyrdp - RDP Man-In-The-Middle And Library For Python3 With The Ability To Watch Connections Live Or After The Fact
PyRDP is a Python 3¬†Remote Desktop Protocol¬†(RDP)¬†Man-in-the-Middle¬†(MITM) and library.
It features a few tools:
RDP Man-in-the-Middle Logs¬†credentials¬†used when connecting Steals data copied to the clipboard Saves a copy of the files transferred over the network Saves replays of connections so you can look at them later Run console commands or¬†PowerShell¬†payloads automatically on new connections RDP Player: See live RDP connections coming from the MITM View replays of RDP connections Take control of active RDP sessions while hiding your actions List the client&amp;rsquo;s mapped drives and download files from them during active sessions RDP Certificate Cloner: Create a self-signed X509 certificate with the same fields as an RDP server&amp;rsquo;s certificate We have used this tool as part of an RDP honeypot which records sessions and saves a copy of the malware dropped on our target machine."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu8b78332b6420dc9affabe23720d11e63_1937019_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>üçá</span></figure><div class=site-meta><h1 class=site-name><a href=/>ZYChimne</a></h1><h2 class=site-description>Computer Science, Wuhan University</h2></div></header><ol class=social-menu><li><a href=https://github.com/ZYChimne target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/ZChimne target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about-me/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About Me</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/2016-09-09-be-mobile-theme-v15-mobile-wordpress_25/>Be Mobile Theme v1.5 ‚Äì Mobile WordPress Theme</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 26, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><p><strong>Kang Asu</strong></p><p><a class=link href=https://1.bp.blogspot.com/-yqVbvEdGolc/XX3R39NA-AI/AAAAAAAABsA/KAcEDbhyHu8hzsr8avONS94eW1GnQS6dgCLcBGAsYHQ/s1600/RDP-MITM-How-it-works.png target=_blank rel=noopener><img src=https://1.bp.blogspot.com/-yqVbvEdGolc/XX3R39NA-AI/AAAAAAAABsA/KAcEDbhyHu8hzsr8avONS94eW1GnQS6dgCLcBGAsYHQ/s320/RDP-MITM-How-it-works.png loading=lazy></a></p><p><strong>Pyrdp - RDP Man-In-The-Middle And Library For Python3 With The Ability To Watch Connections Live Or After The Fact</strong></p><p>PyRDP is a Python 3¬†<a class=link href=https://www.kitploit.com/search/label/Remote%20Desktop%20Protocol title="Remote Desktop Protocol" target=_blank rel=noopener>Remote Desktop Protocol</a>¬†(RDP)¬†<a class=link href=https://www.kitploit.com/search/label/Man-in-the-Middle title=Man-in-the-Middle target=_blank rel=noopener>Man-in-the-Middle</a>¬†(MITM) and library.<br>It features a few tools:</p><ul><li>RDP Man-in-the-Middle<ul><li>Logs¬†<a class=link href=https://www.kitploit.com/search/label/Credentials title=credentials target=_blank rel=noopener>credentials</a>¬†used when connecting</li><li>Steals data copied to the clipboard</li><li>Saves a copy of the files transferred over the network</li><li>Saves replays of connections so you can look at them later</li><li>Run console commands or¬†<a class=link href=https://www.kitploit.com/search/label/PowerShell title=PowerShell target=_blank rel=noopener>PowerShell</a>¬†payloads automatically on new connections</li></ul></li><li>RDP Player:<ul><li>See live RDP connections coming from the MITM</li><li>View replays of RDP connections</li><li>Take control of active RDP sessions while hiding your actions</li><li>List the client&rsquo;s mapped drives and download files from them during active sessions</li></ul></li><li>RDP Certificate Cloner:<ul><li>Create a self-signed X509 certificate with the same fields as an RDP server&rsquo;s certificate</li></ul></li></ul><p>We have used this tool as part of an RDP honeypot which records sessions and saves a copy of the malware dropped on our target machine.<br>PyRDP was¬†<a class=link href=https://www.gosecure.net/blog/2018/12/19/rdp-man-in-the-middle-smile-youre-on-camera title="first introduced in a blogpost" target=_blank rel=noopener>first introduced in a blogpost</a>¬†in which we¬†<a class=link href="https://www.youtube.com/watch?v=eB7RC9FmL6Q" title="demonstrated that we can catch a real threat actor in action" target=_blank rel=noopener>demonstrated that we can catch a real threat actor in action</a>. In May 2019 a¬†<a class=link href="https://docs.google.com/presentation/d/1avcn8Sh2b3IE7AA0G9l7Cj5F1pxqizUm98IbXUo2cvY/edit#slide=id.g404b70030f_0_581" title="presentation by its authors" target=_blank rel=noopener>presentation by its authors</a>¬†was given at NorthSec and two demos were performed.¬†<a class=link href=https://youtu.be/5JztJzi-m48 title="The first one covered" target=_blank rel=noopener>The first one covered</a>¬†credential logging, clipboard stealing, client-side file browsing and a session take-over.¬†<a class=link href=https://youtu.be/bU67tj1RkMA title="The second one covered" target=_blank rel=noopener>The second one covered</a>¬†the execution of cmd or powershell payloads when a client successfully authenticates. In August 2019, PyRDP was demo&rsquo;ed at BlackHat Arsenal (<a class=link href="https://docs.google.com/presentation/d/17P_l2n-hgCehQ5eTWilru4IXXHnGIRTj4ftoW4BiX5A/edit?usp=sharing" title=slides target=_blank rel=noopener>slides</a>).<br><a class=link href=https://www.blogger.com/u/1/null target=_blank rel=noopener></a></p><p><strong>Supported Systems</strong><br>PyRDP should work on Python 3.6 and up.<br>This tool has been tested to work on Python 3.6 on Linux (Ubuntu 18.04) and Windows (See section¬†<a class=link href=https://github.com/gosecure/pyrdp#installing-on-windows title="Installing on Windows" target=_blank rel=noopener>Installing on Windows</a>). It has not been tested on OSX.</p><p><strong>Installing</strong><br>We recommend installing PyRDP in a¬†<a class=link href=https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/ title="virtual environment" target=_blank rel=noopener>virtual environment</a>¬†to avoid dependency issues.<br>First, make sure to install the prerequisite packages (on Ubuntu):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt install libdbus-1-dev libdbus-glib-1-dev
</span></span></code></pre></td></tr></table></div></div><p>On some systems, you may need to install the¬†<code>python3-venv</code>¬†package:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt install python3-venv
</span></span></code></pre></td></tr></table></div></div><p>Then, create your virtual environment in PyRDP&rsquo;s directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd pyrdp   
</span></span><span class=line><span class=cl>python3 -m venv venv
</span></span></code></pre></td></tr></table></div></div><p><em>DO NOT</em>¬†use the root PyRDP directory for the virtual environment folder (<code>python3 -m venv .</code>). You will make a mess, and using a directory name like¬†<code>venv</code>¬†is more standard anyway.<br>Before installing the dependencies, you need to activate your virtual environment:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>source venv/bin/activate
</span></span></code></pre></td></tr></table></div></div><p>Finally, you can install the project with Pip:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip3 install -U pip setuptools wheel  
</span></span><span class=line><span class=cl>pip3 install -U -e .
</span></span></code></pre></td></tr></table></div></div><p>This should install all the dependencies required to run PyRDP.<br>If you ever want to leave your virtual environment, you can simply deactivate it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>deactivate
</span></span></code></pre></td></tr></table></div></div><p>Note that you will have to activate your environment every time you want to have the PyRDP scripts available as shell commands.</p><p><strong>Installing on Windows</strong><br>The steps are almost the same. There are two additional prerequisites.</p><ol><li>Any C compiler</li><li><a class=link href=https://wiki.openssl.org/index.php/Binaries title=OpenSSL target=_blank rel=noopener>OpenSSL</a>. Make sure it is reachable from your¬†<code>$PATH</code>.</li></ol><p>Then, create your virtual environment in PyRDP&rsquo;s directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd pyrdp  
</span></span><span class=line><span class=cl>python3 -m venv venv
</span></span></code></pre></td></tr></table></div></div><p><em>DO NOT</em>¬†use the root PyRDP directory for the virtual environment folder (<code>python3 -m venv .</code>). You will make a mess, and using a directory name like¬†<code>venv</code>¬†is more standard anyway.<br>Before installing the dependencies, you need to activate your virtual environment:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>venv\Scripts\activate
</span></span></code></pre></td></tr></table></div></div><p>Finally, you can install the project with Pip:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip3 install -U pip setuptools wheel  
</span></span><span class=line><span class=cl>pip3 install -U -e .
</span></span></code></pre></td></tr></table></div></div><p>This should install all the dependencies required to run PyRDP.<br>If you ever want to leave your virtual environment, you can simply deactivate it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>deactivate
</span></span></code></pre></td></tr></table></div></div><p>Note that you will have to activate your environment every time you want to have the PyRDP scripts available as shell commands.</p><p><strong>Installing with Docker</strong><br>First of all, build the image by executing this command at the root of PyRDP (where Dockerfile is located):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker build -t pyrdp .
</span></span></code></pre></td></tr></table></div></div><p>Afterwards, you can execute the following command to run the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -it pyrdp pyrdp-mitm.py 192.168.1.10
</span></span></code></pre></td></tr></table></div></div><p>For more information about the various commands and arguments, please refer to these sections:</p><ul><li><a class=link href=https://github.com/gosecure/pyrdp#using-the-pyrdp-man-in-the-middle title="Using the PyRDP MITM" target=_blank rel=noopener>Using the PyRDP MITM</a></li><li><a class=link href=https://github.com/gosecure/pyrdp#using-the-pyrdp-player title="Using the PyRDP Player" target=_blank rel=noopener>Using the PyRDP Player</a></li><li><a class=link href=https://github.com/gosecure/pyrdp#using-the-pyrdp-certificate-cloner title="Using the PyRDP Certificate Cloner" target=_blank rel=noopener>Using the PyRDP Certificate Cloner</a></li></ul><p>To store the PyRDP output permanently (logs, files, etc.), add the -v option to the previous command. For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -v /home/myname/pyrdp_output:/home/pyrdp/pyrdp_output pyrdp pyrdp-mitm.py 192.168.1.10
</span></span></code></pre></td></tr></table></div></div><p>Make sure that your destination directory is owned by a user with a UID of 1000, otherwise you will get a permission denied error. If you&rsquo;re the only user on the system, you should not need to worry about this.</p><p><strong>Using the player in Docker</strong><br>Using the player will require you to export the DISPLAY environment variable from the host to the docker. This redirects the GUI of the player to the host screen. You also need to expose the host&rsquo;s network and stop Qt from using the MIT-SHM X11 Shared Memory Extension. To do so, add the -e and &ndash;net options to the run command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -e DISPLAY=$DISPLAY -e QT_X11_NO_MITSHM=1 --net=host pyrdp pyrdp-player.py
</span></span></code></pre></td></tr></table></div></div><p>Keep in mind that exposing the host&rsquo;s network to the docker can compromise the isolation between your container and the host. If you plan on using the player, X11 forwarding using an SSH connection would be a more secure way.</p><p><strong>Migrating away from pycrypto</strong><br>Since pycrypto isn&rsquo;t maintained anymore, we chose to migrate to pycryptodome. If you get this error, it means that you are using the module pycrypto instead of pycryptodome.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[...]  
</span></span><span class=line><span class=cl>  File &#34;[...]/pyrdp/pyrdp/pdu/rdp/connection.py&#34;, line 10, in   
</span></span><span class=line><span class=cl>    from Crypto.PublicKey.RSA import RsaKey  
</span></span><span class=line><span class=cl>ImportError: cannot import name &#39;RsaKey&#39;
</span></span></code></pre></td></tr></table></div></div><p>You will need to remove the module pycrypto and reinstall PyRDP.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip3 uninstall pycrypto  
</span></span><span class=line><span class=cl>pip3 install -U -e .
</span></span></code></pre></td></tr></table></div></div><p><strong>Using the PyRDP Man-in-the-Middle</strong><br>Use¬†<code>pyrdp-mitm.py</code> ¬†or¬†<code>pyrdp-mitm.py :</code>¬†to run the MITM.<br>Assuming you have an RDP server running on¬†<code>192.168.1.10</code>¬†and listening on port 3389, you would run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-mitm.py 192.168.1.10
</span></span></code></pre></td></tr></table></div></div><p>When running the MITM for the first time on Linux, a private key and certificate should be generated for you in¬†<code>~/.config/pyrdp</code>. These are used when TLS security is used on a connection. You can use them to decrypt PyRDP traffic in Wireshark, for example.</p><p><strong>Specifying the private key and certificate</strong><br>If key generation didn&rsquo;t work or you want to use a custom key and certificate, you can specify them using the¬†<code>-c</code>¬†and¬†<code>-k</code>¬†arguments:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-mitm.py 192.168.1.10 -k private_key.pem -c certificate.pem
</span></span></code></pre></td></tr></table></div></div><p><strong>Connecting to the PyRDP player</strong><br>If you want to see live RDP connections through the PyRDP player, you will need to specify the ip and port on which the player is listening using the¬†<code>-i</code>¬†and¬†<code>-d</code>¬†arguments. Note: the port argument is optional, the default port is 3000.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-mitm.py 192.168.1.10 -i 127.0.0.1 -d 3000
</span></span></code></pre></td></tr></table></div></div><p><strong>Connecting to a PyRDP player when the MITM is running on a server</strong><br>If you are running the MITM on a server and still want to see live RDP connections, you should use¬†<a class=link href=https://www.booleanworld.com/guide-ssh-port-forwarding-tunnelling/ title="SSH remote port forwarding" target=_blank rel=noopener>SSH remote port forwarding</a>¬†to forward a port on your server to the player&rsquo;s port on your machine. Once this is done, you pass¬†<code>127.0.0.1</code>¬†and the forwarded port as arguments to the MITM. For example, if port 4000 on the server is forwarded to the player&rsquo;s port on your machine, this would be the command to use:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-mitm.py 192.168.1.10 -i 127.0.0.1 -d 4000
</span></span></code></pre></td></tr></table></div></div><p><strong>Running payloads on new connections</strong><br>PyRDP has support for running console commands or PowerShell payloads automatically when new connections are made. Due to the nature of RDP, the process is a bit hackish and is not always 100% reliable. Here is how it works:</p><ol><li>Wait for the user to be authenticated.</li><li>Block the client&rsquo;s input / output to hide the payload and prevent interference.</li><li>Send a fake Windows+R sequence and run¬†<code>cmd.exe</code>.</li><li>Run the payload as a console command and exit the console. If a PowerShell payload is configured, it is run with¬†<code>powershell -enc</code> .</li><li>Wait a bit to allow the payload to complete.</li><li>Restore the client&rsquo;s input / output.</li></ol><p>For this to work, you need to set 3 arguments:</p><ul><li>the payload</li><li>the delay before the payload starts</li><li>the payload&rsquo;s duration</li></ul><p><strong>Setting the payload</strong><br>You can use one of the following arguments to set the payload to run:</p><ul><li><code>--payload</code>, a string containing console commands</li><li><code>--payload-powershell</code>, a string containing PowerShell commands</li><li><code>--payload-powershell-file</code>, a path to a PowerShell script</li></ul><p><strong>Choosing when to start the payload</strong><br>For the moment, PyRDP does not detect when the user is logged on. You must give it an amount of time to wait for before running the payload. After this amount of time has passed, it will send the fake key sequences and expect the payload to run properly. To do this, you use the¬†<code>--payload-delay</code>¬†argument. The delay is in milliseconds. For example, if you expect the user to be logged in within the first 5 seconds, you would use the following arguments:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>--payload-delay 5000
</span></span></code></pre></td></tr></table></div></div><p>This could be made more accurate by leveraging some messages exchanged during RDPDR initialization. See¬†<a class=link href=https://github.com/GoSecure/pyrdp/issues/98 title="this issue" target=_blank rel=noopener>this issue</a>¬†if you&rsquo;re interested in making this work better.</p><p><strong>Choosing when to resume normal activity</strong><br>Because there is no direct way to know when the console has stopped running, you must tell PyRDP how long you want the client&rsquo;s input / output to be blocked. We recommend you set this to the maximum amount of time you would expect the console that is running your payload to be visible. In other words, the amount of time you would expect your payload to complete. To set the payload duration, you use the¬†<code>--payload-duration</code>¬†argument with an amount of time in milliseconds. For example, if you expect your payload to take up to 5 seconds to complete, you would use the following argument:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>--payload-duration 5000
</span></span></code></pre></td></tr></table></div></div><p>This will block the client&rsquo;s input / output for 5 seconds to hide the console and prevent interference. After 5 seconds, input / output is restored back to normal.</p><p><strong>Other MITM arguments</strong><br>Run¬†<code>pyrdp-mitm.py --help</code>¬†for a full list of arguments.</p><p><strong>Using the PyRDP Player</strong><br>Use¬†<code>pyrdp-player.py</code>¬†to run the player.</p><p><strong>Playing a replay file</strong><br>You can use the menu to open a new replay file: File > Open.<br>You can also open replay files when launching the player:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-player.py   ...
</span></span></code></pre></td></tr></table></div></div><p><strong>Listening for live connections</strong><br>The player always listens for live connections. By default, the listening port is 3000, but it can be changed:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pyrdp-player.py -p 
</span></span></code></pre></td></tr></table></div></div><p><strong>Changing the listening address</strong><br>By default, the player only listens to connections coming from the local machine. We do not recommend opening up the player to other machines. If you still want to change the listening address, you can do it with¬†<code>-b</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>`pyrdp-player.py -b` 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Other player arguments**  
</span></span><span class=line><span class=cl>Run¬†`pyrdp-player.py --help`¬†for a full list of arguments.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Using the PyRDP Certificate Cloner**  
</span></span><span class=line><span class=cl>The PyRDP certificate cloner creates a brand new X509 certificate by using the values from an existing RDP server&#39;s certificate. It connects to an RDP server, downloads its certificate, generates a new private key and replaces the public key and signature of the certificate using the new private key. This can be used in a pentest if, for example, you&#39;re trying to trick a legitimate user into going through your MITM. Using a certificate that looks like a legitimate certificate could increase your success rate.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Cloning a certificate**  
</span></span><span class=line><span class=cl>You can clone a certificate by using¬†`pyrdp-clonecert.py`:
</span></span></code></pre></td></tr></table></div></div><p>pyrdp-clonecert.py 192.168.1.10 cert.pem -o key.pem</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The¬†`-o`¬†parameter defines the path name to use for the generated private key.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Using a custom private key**  
</span></span><span class=line><span class=cl>If you want to use your own private key instead of generating a new one:
</span></span></code></pre></td></tr></table></div></div><p>pyrdp-clonecert.py 192.168.1.10 cert.pem -i input_key.pem</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Other cloner arguments**  
</span></span><span class=line><span class=cl>Run¬†`pyrdp-clonecert.py --help`¬†for a full list of arguments.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Using PyRDP as a Library**  
</span></span><span class=line><span class=cl>If you&#39;re interested in experimenting with RDP and making your own tools, head over to our¬†[documentation section](https://github.com/GoSecure/pyrdp/blob/master/docs/README.md &#34;documentation section&#34;)¬†for more information.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Using PyRDP with Bettercap**  
</span></span><span class=line><span class=cl>We developped our own Bettercap module,¬†`rdp.proxy`, to man-in-the-middle all RDP connections on a given LAN. Check out¬†[this document](https://github.com/GoSecure/pyrdp/blob/master/docs/bettercap-rdp-mitm.md &#34;this document&#34;)¬†for more information.  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**PyRDP Presentations**  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Contributing to PyRDP**  
</span></span><span class=line><span class=cl>See our¬†[contribution guidelines](https://github.com/GoSecure/pyrdp/blob/master/CONTRIBUTING.md &#34;contribution guidelines&#34;).  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>**Acknowledgements**  
</span></span><span class=line><span class=cl>PyRDP uses code from the following open-source software:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*   [RC4-Python](https://github.com/bozhu/RC4-Python &#34;RC4-Python&#34;)¬†for the RC4 implementation.
</span></span><span class=line><span class=cl>*   [rdesktop](https://github.com/rdesktop/rdesktop &#34;rdesktop&#34;)¬†for bitmap decompression.
</span></span><span class=line><span class=cl>*   [rdpy](https://github.com/citronneur/rdpy &#34;rdpy&#34;)¬†for RC4 keys, the bitmap decompression bindings and the base GUI code for the PyRDP player.
</span></span><span class=line><span class=cl>*   [FreeRDP](https://github.com/FreeRDP/FreeRDP &#34;FreeRDP&#34;)¬†for the scan code enumeration.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**[Download Pyrdp](http://eunsetee.com/9kHV &#34;Download Pyrdp&#34;)**
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**Regards**
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**Kang Asu**
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 ZYChimne</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>