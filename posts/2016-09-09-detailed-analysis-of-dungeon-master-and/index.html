<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Overview This document provides a detailed description of the floppy disk used by Dungeon Master and Chaos Strikes Back for Atari ST. All versions of Dungeon Master and Chaos Strikes Back for Atari ST were studied:
Dungeon Master version 1.0 English (1987-12-08) Dungeon Master version 1.0 English (1987-12-11) Dungeon Master version 1.1 English Dungeon Master version 1.2 English Dungeon Master version 1.2 German Dungeon Master version 1.3 French Chaos Strikes Back version 2."><title>Detailed Analysis of Dungeon Master and Chaos Strikes Back Atari ST Floppy Disks</title><link rel=canonical href=https://Nexus-Security.github.io/posts/2016-09-09-detailed-analysis-of-dungeon-master-and/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property="og:title" content="Detailed Analysis of Dungeon Master and Chaos Strikes Back Atari ST Floppy Disks"><meta property="og:description" content="Overview This document provides a detailed description of the floppy disk used by Dungeon Master and Chaos Strikes Back for Atari ST. All versions of Dungeon Master and Chaos Strikes Back for Atari ST were studied:
Dungeon Master version 1.0 English (1987-12-08) Dungeon Master version 1.0 English (1987-12-11) Dungeon Master version 1.1 English Dungeon Master version 1.2 English Dungeon Master version 1.2 German Dungeon Master version 1.3 French Chaos Strikes Back version 2."><meta property="og:url" content="https://Nexus-Security.github.io/posts/2016-09-09-detailed-analysis-of-dungeon-master-and/"><meta property="og:site_name" content="ZYChimne"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:published_time" content="2019-09-27T05:07:00+01:00"><meta property="article:modified_time" content="2019-09-27T05:07:00+01:00"><meta name=twitter:title content="Detailed Analysis of Dungeon Master and Chaos Strikes Back Atari ST Floppy Disks"><meta name=twitter:description content="Overview This document provides a detailed description of the floppy disk used by Dungeon Master and Chaos Strikes Back for Atari ST. All versions of Dungeon Master and Chaos Strikes Back for Atari ST were studied:
Dungeon Master version 1.0 English (1987-12-08) Dungeon Master version 1.0 English (1987-12-11) Dungeon Master version 1.1 English Dungeon Master version 1.2 English Dungeon Master version 1.2 German Dungeon Master version 1.3 French Chaos Strikes Back version 2."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue825486955cd7c56d95e38b4bd2a8e3c_229979_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>ZYChimne</a></h1><h2 class=site-description>Computer Science, Wuhan University</h2></div></header><ol class=social-menu><li><a href=https://github.com/Nexus-Security target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:0x000216@gmail.com target=_blank title=Email><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-gmail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=https://www.buymeacoffee.com/0x000216 target=_blank title=Coffee><svg width="884" height="1279" viewBox="0 0 884 1279" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><defs><path d="M0 0H884V1279H0V0z" id="path_1"/><clipPath id="mask_1"><use xlink:href="#path_1"/></clipPath></defs><g id="buymeacoffee"><path d="M0 0H884V1279H0V0z" id="Background" fill="none" fill-rule="evenodd" stroke="none"/><g clip-path="url(#mask_1)"><path d="M791.109 297.518 790.231 297.002 788.201 296.383C789.018 297.072 790.04 297.472 791.109 297.518z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M803.916 388.891l-1 1 1-1z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M792.113 297.647C791.776 297.581 791.447 297.462 791.127 297.29 791.108 297.622 791.108 297.958 791.127 298.29 791.488 298.216 791.83 297.995 792.113 297.647z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M791.113 298.447h1v-1l-1 1z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M803.111 388.726 804.591 387.883 805.142 387.573 805.641 387.04C804.702 387.444 803.846 388.016 803.111 388.726z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M793.669 299.515 792.223 298.138 791.243 297.605C791.77 298.535 792.641 299.221 793.669 299.515z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M430.019 1186.18C428.864 1186.68 427.852 1187.46 427.076 1188.45L427.988 1187.87C428.608 1187.3 429.485 1186.63 430.019 1186.18z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M641.681 1144.63C641.681 1143.33 640.424 1143.57 640.729 1148.21 640.729 1147.84 641.035 1147.46 641.171 1147.1 641.341 1146.27 641.477 1145.46 641.681 1144.63z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M619.284 1186.18C618.129 1186.68 617.118 1187.46 616.342 1188.45L617.254 1187.87C617.873 1187.3 618.751 1186.63 619.284 1186.18z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M281.304 1196.06C280.427 1195.3 279.354 1194.8 278.207 1194.61 279.136 1195.06 280.065 1195.51 280.684 1195.85L281.304 1196.06z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M247.841 1164.01C247.704 1162.66 247.288 1161.35 246.619 1160.16 247.093 1161.39 247.489 1162.66 247.806 1163.94L247.841 1164.01z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M472.623 590.836c-45.941 19.667-98.077 41.966-165.647 41.966C278.71 632.746 250.58 628.868 223.353 621.274l46.733 479.806C271.74 1121.13 280.876 1139.83 295.679 1153.46 310.482 1167.09 329.87 1174.65 349.992 1174.65 349.992 1174.65 416.254 1178.09 438.365 1178.09 462.161 1178.09 533.516 1174.65 533.516 1174.65c20.12.0 39.503-7.57000000000016 54.303-21.2C602.619 1139.82 611.752 1121.13 613.406 1101.08l50.053-530.204C641.091 563.237 618.516 558.161 593.068 558.161 549.054 558.144 513.591 573.303 472.623 590.836z" id="Shape" fill="#fff" stroke="none"/><path d="M78.6885 386.132 79.4799 386.872 79.9962 387.182C79.5987 386.787 79.1603 386.435 78.6885 386.132z" id="Shape" fill="#0d0c22" stroke="none"/><path d="M879.567 341.849 872.53 306.352C866.215 274.503 851.882 244.409 819.19 232.898 808.711 229.215 796.821 227.633 788.786 220.01 780.751 212.388 778.376 200.55 776.518 189.572 773.076 169.423 769.842 149.257 766.314 129.143 763.269 111.85 760.86 92.4243 752.928 76.56c-10.324-21.3016-31.746-33.7591-53.048-42.001C688.965 30.4844 677.826 27.0375 666.517 24.2352 613.297 10.1947 557.342 5.03277 502.591 2.09047 436.875-1.53577 370.983-.443233 305.422 5.35968 256.625 9.79894 205.229 15.1674 158.858 32.0469c-16.948 6.1771-34.413 13.593-47.3 26.6872C95.7448 74.8221 90.5829 99.7026 102.128 119.765c8.208 14.247 22.111 24.313 36.857 30.972C158.192 159.317 178.251 165.846 198.829 170.215c57.297 12.664 116.642 17.636 175.178 19.753C438.887 192.586 503.87 190.464 568.44 183.618 584.408 181.863 600.347 179.758 616.257 177.304 634.995 174.43 647.022 149.928 641.499 132.859 634.891 112.453 617.134 104.538 597.055 107.618 594.095 108.082 591.153 108.512 588.193 108.942L586.06 109.252C579.257 110.113 572.455 110.915 565.653 111.661c-14.052 1.514-28.138 2.753-42.259 3.717C491.768 117.58 460.057 118.595 428.363 118.647c-31.144.0-62.305-.878-93.38-2.92500000000001C320.805 114.793 306.661 113.611 292.552 112.177 286.134 111.506 279.733 110.801 273.333 110.009L267.241 109.235 265.917 109.046 259.602 108.134C246.697 106.189 233.792 103.953 221.025 101.251 219.737 100.965 218.584 100.249 217.758 99.2193 216.932 98.1901 216.482 96.9099 216.482 95.5903 216.482 94.2706 216.932 92.9904 217.758 91.9612 218.584 90.9319 219.737 90.2152 221.025 89.9293H221.266C232.33 87.5721 243.479 85.5589 254.663 83.8038 258.392 83.2188 262.131 82.6453 265.882 82.0832H265.985C272.988 81.6186 280.026 80.3625 286.994 79.5366 347.624 73.2302 408.614 71.0801 469.538 73.1014 499.115 73.9618 528.676 75.6996 558.116 78.6935 564.448 79.3474 570.746 80.0357 577.043 80.8099 579.452 81.1025 581.878 81.4465 584.305 81.7391L589.191 82.4445C603.438 84.5667 617.61 87.1419 631.708 90.1703 652.597 94.7128 679.422 96.1925 688.713 119.077 691.673 126.338 693.015 134.408 694.649 142.03L696.731 151.752C696.786 151.926 696.826 152.105 696.852 152.285 701.773 175.227 706.7 198.169 711.632 221.111 711.994 222.806 712.002 224.557 711.657 226.255 711.312 227.954 710.621 229.562 709.626 230.982 708.632 232.401 707.355 233.6 705.877 234.504 704.398 235.408 702.75 235.997 701.033 236.236H700.895L697.884 236.649 694.908 237.044C685.478 238.272 676.038 239.419 666.586 240.486 647.968 242.608 629.322 244.443 610.648 245.992 573.539 249.077 536.356 251.102 499.098 252.066 480.114 252.57 461.135 252.806 442.162 252.771 366.643 252.712 291.189 248.322 216.173 239.625 208.051 238.662 199.93 237.629 191.808 236.58 198.106 237.389 187.231 235.96 185.029 235.651 179.867 234.928 174.705 234.177 169.543 233.397 152.216 230.798 134.993 227.598 117.7 224.793 96.7944 221.352 76.8005 223.073 57.8906 233.397c-15.5221 8.494-28.0851 21.519-36.013 37.338-8.1559 16.862-10.582 35.221-14.22974 53.34-3.64777 18.118-9.32591 37.613-7.17511 56.213C5.10128 420.431 33.165 453.054 73.5313 460.35 111.506 467.232 149.687 472.807 187.971 477.556 338.361 495.975 490.294 498.178 641.155 484.129 653.44 482.982 665.708 481.732 677.959 480.378 681.786 479.958 685.658 480.398 689.292 481.668S696.23 485.005 698.962 487.717 703.784 493.718 705.08 497.342C706.377 500.967 706.846 504.836 706.453 508.665L702.633 545.797c-7.697 75.031-15.394 150.057-23.091 225.077-8.029 78.783-16.111 157.56-24.244 236.326C653.004 1029.39 650.71 1051.57 648.416 1073.74 646.213 1095.58 645.904 1118.1 641.757 1139.68 635.218 1173.61 612.248 1194.45 578.73 1202.07 548.022 1209.06 516.652 1212.73 485.161 1213.01 450.249 1213.2 415.355 1211.65 380.443 1211.84 343.173 1212.05 297.525 1208.61 268.756 1180.87 243.479 1156.51 239.986 1118.36 236.545 1085.37 231.957 1041.7 227.409 998.039 222.9 954.381L197.607 711.615 181.244 554.538C180.968 551.94 180.693 549.376 180.435 546.76 178.473 528.023 165.207 509.681 144.301 510.627 126.407 511.418 106.069 526.629 108.168 546.76l12.13 116.454 25.087 240.89C152.532 972.528 159.661 1040.96 166.773 1109.41 168.15 1122.52 169.44 1135.67 170.885 1148.78 178.749 1220.43 233.465 1259.04 301.224 1269.91 340.799 1276.28 381.337 1277.59 421.497 1278.24 472.979 1279.07 524.977 1281.05 575.615 1271.72 650.653 1257.95 706.952 1207.85 714.987 1130.13 717.282 1107.69 719.576 1085.25 721.87 1062.8 729.498 988.559 737.115 914.313 744.72 840.061l24.881-242.61 11.408-111.188C781.577 480.749 783.905 475.565 787.649 471.478 791.392 467.391 796.352 464.617 801.794 463.567 823.25 459.386 843.761 452.245 859.023 435.916c24.295-25.998 29.13-59.895 20.544-94.067zM72.7365 365.835C73.247 365.68 72.3065 368.484 71.9034 369.792 71.8229 367.813 71.984 366.058 72.7365 365.835zm1.7756 16.105C74.6842 381.819 75.2003 382.508 75.7337 383.334 74.925 382.576 74.4089 382.009 74.4949 381.94H74.5121zM76.5597 384.641C77.6004 385.897 78.1569 386.689 76.5597 384.641zM80.7002 387.979h.2727C80.9729 388.313 81.473 388.645 81.6548 388.979 81.3533 388.612 81.0186 388.277 80.6548 387.979H80.7002zM800.796 382.989C793.088 390.319 781.473 393.726 769.996 395.43c-128.704 19.099-259.283 28.769-389.399 24.502C287.476 416.749 195.336 406.407 103.144 393.382 94.1102 392.109 84.3197 390.457 78.1082 383.798c-11.7004-12.561-5.9534-37.854-2.9079-53.03C77.9878 316.865 83.3218 298.334 99.8572 296.355 125.667 293.327 155.64 304.218 181.175 308.09 211.917 312.781 242.774 316.538 273.745 319.36 405.925 331.405 540.325 329.529 671.92 311.91 695.905 308.686 719.805 304.941 743.619 300.674 764.835 296.871 788.356 289.731 801.175 311.703 809.967 326.673 811.137 346.701 809.778 363.615 809.359 370.984 806.139 377.915 800.779 382.989H800.796z" id="Shape" fill="#fff" fill-rule="evenodd" stroke="none"/></g></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about-me/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About Me</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/2016-09-09-detailed-analysis-of-dungeon-master-and/>Detailed Analysis of Dungeon Master and Chaos Strikes Back Atari ST Floppy Disks</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 27, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>43 minute read</time></div></footer></div></header><section class=article-content><h3 id=overview>Overview</h3><p>This document provides a detailed description of the floppy disk used by Dungeon Master and Chaos Strikes Back for Atari ST. All versions of Dungeon Master and Chaos Strikes Back for Atari ST were studied:</p><ul><li>Dungeon Master version 1.0 English (1987-12-08)</li><li>Dungeon Master version 1.0 English (1987-12-11)</li><li>Dungeon Master version 1.1 English</li><li>Dungeon Master version 1.2 English</li><li>Dungeon Master version 1.2 German</li><li>Dungeon Master version 1.3 French</li><li>Chaos Strikes Back version 2.0 English (Game Disk)</li><li>Chaos Strikes Back version 2.1 English (Game Disk)</li></ul><p>The first part of the document contains general information explaining how data is stored on a floppy disk and how it is read. This technical information is required in order to fully understand the second part of the document that describes the contents of the game&rsquo;s floppy disk and particularly the sectors used by the copy protection scheme.</p><h3 id=technical-background>Technical background</h3><h4 id=some-definitions>Some definitions</h4><p><strong>Floppy disk</strong>: A data storage media in the shape of a disk whose surface is coated with a magnetic material on both sides. You can think of this coating as a huge number of tiny magnets that can be oriented as desired. Each magnet creates a small magnetic field and has a north pole and a south pole. Identical poles repel themselves while different poles attract themselves.<br><a class=link href=http://dmweb.free.fr/files/TechDoc-FloppyDisk.png title="Floppy Disk" target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/TechDoc-FloppyDiskThumbnail.png loading=lazy alt="Floppy Disk"></a><br><strong>Floppy disk drive</strong>: The electromechanical device used to read and write data on floppy disks. Its main components include a motor to rotate the disk, a head to read/write data to disks and a second step by step motor to move the head across the disk.<br><a class=link href=http://dmweb.free.fr/files/TechDoc-FloppyDiskDrive.jpg title="Floppy Disk Drive" target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/TechDoc-FloppyDiskDriveThumbnail.jpg loading=lazy alt="Floppy Disk Drive"></a><br><strong>Floppy disk controller (FDC)</strong>: An electronic chip connected to the floppy disk drive and designed to manage it. In a computer, programs can only talk with the FDC and never directly with the floppy disk drive.</p><h4 id=organizing-data-on-the-disk>Organizing data on the disk</h4><p>The physical surface of a floppy disk is homogeneous. However, this surface is logically divided into smaller parts to make it easier to read and write small amounts of data at a time. First, the surface is divided into tracks. A track is a circular area on the floppy disk. On figure 1, the orange area represents a track. Tracks are numbered starting at 0 and the first track is on the outer edge of the surface. The innermost track depicted in green represents the last track.<br>Each track is divided into smaller parts called sectors. On figure 1, the red area represents a sector on track 0, the first track. The yellow area represents another sector. While the actual length of these two sectors are very different (the outermost being much longer), every sector contains the same amount of data. Because the drive rotates the floppy disk at a constant angular speed, the drive&rsquo;s head will spend the same amount of time above all sectors, no matter which track they are part of.<br><strong>Figure 1</strong><br><a class=link href=http://dmweb.free.fr/files/TechDoc-FloppyDiskStructure.png title="Floppy Disk Structure" target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/TechDoc-FloppyDiskStructureThumbnail.png loading=lazy alt="Floppy Disk Structure"></a></p><p>A sector is the smallest area that can be read or written: if you want to read a single byte of data from the floppy disk, you need to read the whole sector and then extract the byte you want from this sector data. Similarly, if you want to write a single byte of data to the floppy disk, you must first read the content of the sector where the byte will be written, modify the byte you want in memory and then write back the whole sector.</p><p>When the drive starts to write data to the floppy disk, there is some imprecision to where exactly it will start. In order to avoid any overlap while writing a particular sector, there are areas called &lsquo;gaps&rsquo; between each sector and also between the beginning and end of a track. These gaps provide some tolerance for the start and end locations of sectors. Gaps do not contain any useful user data.</p><h4 id=storing-binary-data-using-magnetic-states>Storing binary data using magnetic states</h4><p>Floppy disks are designed to record digital data, which are series of bits of information (&lsquo;0&rsquo; and &lsquo;1&rsquo; values). For that purpose, only two different magnetic states are required (contrary to analog recording like on audio tapes).<br>The floppy disk surface is virtually divided into small areas. When all the magnets in an area are oriented in the same way, their individual magnetic fields combine themselves to produce a stronger and significant magnetic field, also called a &lsquo;magnetic flux&rsquo;. Information is stored on the disk by creating series of areas where all magnets are oriented in the same way, thus creating two types of magnetized areas: &rsquo;north poles areas&rsquo; or &lsquo;south poles areas&rsquo;. Binary data is stored using these two states, but they do not directly map to bit values (zeros and ones). In fact, each bit is stored using two adjacent magnetized areas, forming what is called a &lsquo;bit cell&rsquo;:</p><ul><li>Two areas with different magnetizations (a north pole and a south pole, in any order) represent a &lsquo;1&rsquo; bit. Such a bit cell is said to contain a &lsquo;flux reversal&rsquo;.</li><li>Two areas with identical magnetization (two north poles or two south poles) represent a &lsquo;0&rsquo; bit. Such a bit cell does not contain a &lsquo;flux reversal&rsquo;.</li></ul><p>This scheme is necessary because when reading information from the floppy disk, the drive is not able to detect the magnetization of an area as a north pole or a south pole. It can only detect flux reversals.<br>As a result, data on a track is stored as regions of opposite magnetization, which is illustrated on figure 1 by the small zoomed portion of a sector.</p><p>Changing the orientation of the magnets (in order to write information to the disk) or detecting flux reversals (in order to read information from the disk) relies on the physical phenomenon named &rsquo;electromagnetic induction&rsquo; that has two aspects:</p><ul><li>A changing magnetic field will create an electric current in a nearby electric circuit. Note that a constant magnetic field will not create any current. This is why only flux reversals can be detected and not the absolute magnetization of the surface.</li><li>The flow of electicity in an electric circuit produces a magnetic field.</li></ul><p>These two aspects are used in the head of a floppy disk drive. The head contains a small coil and is the part of the disk drive that is the closest to the disk surface (without touching it) and allows reading and writing.</p><h4 id=reading-and-writing-data>Reading and writing data</h4><p>In order to write data to the disk, the computer sends binary data that is converted to a current in the head coil. This current is reversed when a &lsquo;1&rsquo; bit is sent and remains the same when a &lsquo;0&rsquo; bit is sent. The current in the coil produces a magnetic field whose direction depends on the way the current is flowing in the head. The magnets on the disk surface will then change their orientation to align with the magnetic field produced by the head coil. By using the appropriate electrical signal, it is thus possible to create areas on the disk oriented in one way or the other. The shape of the writing current in the head is represented on figure 2.</p><p>In order to read data from the disk, the head is not powered. While moving above the disk surface, the flux reversals on the media will induce electric pulses in the head coil. The presence of an electric pulse is translated to a &lsquo;1&rsquo; bit and the absence of pulse is translated to a &lsquo;0&rsquo; bit. The shape of the reading current in the head is represented on figure 2.<br>Detecting a &lsquo;1&rsquo; bit is fairly easy as a pulse is generated, but detecting a &lsquo;0&rsquo; bit requires some timing: the floppy disk controller has to wait for some time before concluding that no flux reversal occured when one could have occured. Also, if there was a large number of consecutive &lsquo;0&rsquo; bits written on the disk, it would be difficult for the FDC to accurately count these bits. This is why the FDC requires an accurate synchronization with the data flow coming from the head of the floppy drive. This requirement is achieved by two things described in the following sections: an encoding scheme for data written to the disk and a system inside the FDC so that it automatically synchronizes its clock with the electrical pulses it receives while reading from the floppy disk drive.</p><h4 id=encoding-data>Encoding data</h4><p>Floppy disks on Atari ST use an encoding named &lsquo;Modified Frequency Modulation&rsquo; (MFM). This simple encoding is used to prevent long series of &lsquo;0&rsquo; bits from being written to the floppy disk. In MFM encoding, the stream of data bits that you want to write to the floppy disk is modified by inserting an additional bit, called a clock bit, between each pair of data bits. The value of a clock bit depends on the values of the two data bits around it: if both data bits are &lsquo;0&rsquo;, then the clock bit is set to &lsquo;1&rsquo;. Otherwise, the clock bit is set to &lsquo;0&rsquo;.<br>This encoding ensures that there are no sequences of more than three consecutive &lsquo;0&rsquo; bits.<br>Figure 2 illustrates the MFM encoding of two data bytes of value $68 by highlighting the data bits and clock bits with different colors.</p><p>Note: this MFM encoding is also used on other computers like on PC. There are also other encodings like FM or GCR.</p><p><strong>Figure 2</strong><br><a class=link href=http://dmweb.free.fr/files/TechDoc-BitCells.png title="Bit Cells" target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/TechDoc-BitCellsThumbnail.png loading=lazy alt="Bit Cells"></a></p><h4 id=synchronizing-the-fdc>Synchronizing the FDC</h4><p>The FDC needs a clock so that it knows the rate at which it should output data bits interpreted from the electrical signal it receives from the floppy disk drive. For this purpose, it uses an &lsquo;inspection window&rsquo; which is a time frame during which the FDC waits for an electrical pulse (a flux reversal) to occur.</p><p>The <em>size</em> of a bit cell is the amount of time it takes for the drive&rsquo;s head to move across a bit cell on the disk. On Atari ST, the floppy disk rotates under the head at a constant angular speed of about 300rpm (rotations per minute) but there can be small speed differences from drive to drive (a more or less 1% tolerance).<br>For MFM disks on Atari ST, the bit cell size is standard at 2µs (microseconds), but the small possible variations of disk rotation speed means that the bit cell size can appear shorter or longer when read by the FDC.</p><p>Note: In this document, a <em>bit cell</em> refers to an area on the disk surface that either contains a flux reversal or does not contain one. Using this definition, an MFM bit cell is 2µs wide. In some other documents, the term <em>bit cell</em> may be used to refer to a bit of useful user data, each of which is stored on the disk as the data bit itself and the additional clock bit. With this alternate definition, an MFM bit cell is 4µs wide because it contains both a data bit and a clock bit.</p><p>The FDC contains a part called a &lsquo;Phase-Locked Loop&rsquo; (PLL) which is responsible for automatically adjusting the inspection window to the input signal. When pulses are found, the PLL automatically adjusts the size and position of the inspection window so that pulses occur right in the middle of the inspection window.<br>In a perfect case, the inspection window would be exactly 2µs (microseconds) and each pulse would occur exactly in the middle of the inspection window.<br>When adjusted, the FDC monitors the electrictal signal for a 2µs time frame. If a pulse occurs during this time frame, the FDC interprets it as a &lsquo;1&rsquo; bit and outputs it. If no pulse occurs during this time frame, the FDC interprets it as a &lsquo;0&rsquo; bit and outputs it.<br>The result is a raw sequence of bits. The next step is to separate the data bits from the clock bits.</p><h4 id=separating-data-bits-and-clock-bits>Separating data bits and clock bits</h4><p>This task is performed by a part of the FDC called the &lsquo;data separator&rsquo; and is achieved by searching for a very specific bit pattern in the raw sequence of bits. This pattern is called a &lsquo;synchronization mark&rsquo; as it indicates to the data separator where to start its job. This mark is written using a special command of the FDC. It cannot appear in normal user data because the mark violates the MFM encoding rule: it contains a &lsquo;0&rsquo; clock bit inserted between two &lsquo;0&rsquo; data bits (note that it does not violates the rule of the 3 maximum consecutive &lsquo;0&rsquo; bits). This mark is called A1 because it is similar to the encoding of the hexadecimal value $A1. The mark is also noted $4489 as it is the exact value written to disk when including data bits and clock bits.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Binary representation of $A1 byte: 1 0 1 0 0 0 0 1 MFM encoded representation of $A1: 100010010101001 The synchronization mark value is: 100010010**_0_**01001 (which is $4489 in hexadecimal)
</span></span></code></pre></td></tr></table></div></div><p>The MFM encoded representation is the value written to the disk when writing $A1 as part of normal data.<br>The synchronization mark value is written to the disk when using the appropriate special FDC command. When reading this bit sequence, the FDC will know it is a synchronization mark because one bit (the one in bold) is a &lsquo;0&rsquo; instead of the &lsquo;1&rsquo; it would be for normal MFM encoded data.<br>Once the synchronization mark has been found, it is easy for the FDC to tell which bits are the clock bits and which ones are the data bits.</p><h4 id=track-layout>Track layout</h4><p>The track layout defines the logical structure of a track. Each track contains an &lsquo;index mark&rsquo; to indicate the beginning of the track. This index mark is preceded by a gap and synchronization marks. Gaps are locations where no useful data is written. This data is used to help the PLL synchronization process and also to avoid any overlap between sectors when overwriting a single sector (because there is an imprecision about where the writing will start exactly).<br>Following this index mark are the sectors in the track. Each sector contains a header field and a data field. The sector header field is preceded by a gap and synchronization marks. It contains the following information about the sector:</p><ul><li>the track number</li><li>the side number (0 or 1 for the two possible sides of the floppy disk)</li><li>the sector number (sector numbering starts at 1, unlike track numbering that starts at 0)</li><li>the size of the sector. The possible sizes are 128 bytes, 256 bytes, 512 bytes and 1024 bytes. 512 bytes is the standard sector size on Atari ST.</li><li>a CRC (Cyclic Redundancy Check) value used to detect errors in the sector header field.</li></ul><p>The sector data field is also preceded by a gap and synchronization marks. It contains the following information:</p><ul><li>the 512 bytes of user data</li><li>a CRC value used to detect errors in the sector data field.</li></ul><h4 id=floppy-disk-formats>Floppy disk formats</h4><p>There are many possible floppy disk formats that use varying numbers of tracks, sectors per track and sector sizes. The format of a floppy disk is defined when the disk is formated. When a floppy disk is formated, each track is written at once (not sector by sector), thus defining the number of sectors and their size, the size of gaps, etc. This operation is called low-level formating. High-level formating means installing a file system on the floppy disk. Usually low and high level formating are performed together.</p><p>A standard Atari ST floppy disk has two sides, 80 tracks per side (numbered 0 to 79), 9 sectors per track (numbered 1 to 9) and 512 bytes per sector. The resulting storage capacity is 2 sides x 80 tracks x 9 sectors per track x 512 bytes per sector = 737280 Bytes = 720 KB. It is possible to store 10 or even 11 sectors per track by reducing the size of gaps.</p><h3 id=detailed-structure-of-the-games-floppy-disk>Detailed structure of the games&rsquo; floppy disk</h3><h4 id=general-layout>General layout</h4><p>All versions of Dungeon Master and Chaos Strikes Back for Atari ST use the same floppy disk format. The format is similar to the standard floppy disk format but with 10 sectors per track instead of 9 in order to store more data on the floppy disk. However, they use only one side of the floppy disk (single sided certified floppy disks were cheaper back at that time, and the first generation of Atari ST had only a single sided disk drive). The resulting storage capacity is: 1 side x 80 tracks x 10 sectors per track x 512 bytes per sector = 409600 Bytes = 400 KB.<br>This storage capacity is fully used by the game as all sectors contain data. It would have not been possible to store all the game data on a single side of a standard Atari ST floppy disk that could only contain 360 KB.<br>While non standard, this format should not be considered a part of the game&rsquo;s copy protection scheme because there is no technical difficulty in copying such a disk format.<br>Track 0 contains a standard Atari ST boot sector and file system as well as two special sectors used by the copy protection scheme. The last two sectors in track 0 and all sectors in other tracks are used to store the game&rsquo;s files. These last sectors will not be described further in this document as they are completely standard and just contain the game&rsquo;s program and data files.</p><h4 id=track-0-sector-1-boot-sector>Track 0, Sector 1: Boot sector</h4><p>This sector is identical in all versions of Dungeon Master and Chaos Strikes Back for Atari ST.<br>When the computer starts, the BIOS performs some hardware initialization, then it tries to boot from the floppy disk.<br>For that purpose, it will load in memory the first sector of the first track (sector 1 of track 0).<br>The Atari ST BIOS ensures that the floppy disk is bootable. This check is performed by computing a checksum on the 512 bytes of the boot sector data. This checksum algorithm adds the 256 words in the boot sector. If the result is $1234 then the BIOS assumes that the sector is bootable.<br>The sector is then executed starting at offset 0.</p><p>The floppy disk contains a standard Atari ST boot sector including the default loader code. The boot sector contains:</p><ul><li>A branch instruction to the beginning of the Loader code.</li><li>Data describing the floppy disk format.</li><li>The Loader configuration: instructs the loader code to load and execute the file named SWOOSH.IMG.</li><li>The Loader code.</li><li>Padding $00 bytes until the end of the sector.</li><li>A last word which value is computed so that the checksum of the sector is $1234.</li></ul><p>The loader is configured to load in memory the file named SWOOSH.IMG and then run this program.<br>The code in the boot sector will load in memory the appropriate sectors containing the File Allocation Table (FAT) and the root directory listing. It will use this data to search for the SWOOSH.IMG file. The file is then loaded in memory at address $40000. The program is then executed starting at address $40000.</p><p>Here is an hexadecimal dump of the data in this sector:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 60 38 4C 6F 61 64 65 72 00 00 00 00 02 02 01 00 \`8Loader........ 00000010 02 10 00 24 03 F8 02 00 0A 00 01 00 00 00 00 00 ...$.ø.......... 00000020 00 00 00 00 00 00 00 04 00 00 00 00 00 00 53 57 ..............SW 00000030 4F 4F 53 48 20 20 49 4D 47 00 70 07 32 3C 07 77 OOSH IMG.p.2&lt;.w 00000040 48 E7 C0 00 3F 3C 00 25 4E 4E 54 8F 4C DF 00 03 HçÀ.?&lt;.%NNT.Lß.. 00000050 20 7C FF FF 82 40 30 81 04 41 01 11 51 C8 FF E2 |ÿÿ‚@0..A..QÈÿ 00000060 20 7C FF FF 82 40 70 0F 42 58 51 C8 FF FC 33 FA |ÿÿ‚@p.BXQÈÿü3ú 00000070 FF AE 00 00 04 82 3F 39 00 00 04 46 3F 3C 00 07 ÿ®...‚?9...F?&lt;.. 00000080 4E 4D 58 4F 4A 80 67 00 00 F6 2A 40 41 FA FF 9C NMXOJ€g..ö\*@Aúÿœ 00000090 4A 90 66 06 20 B9 00 00 04 32 30 2D 00 08 E1 48 J.f. ¹...20-..áH 000000A0 D0 80 38 40 D9 FA FF 84 30 3A FF 76 67 10 3C 3A Ð€8@Ùúÿ„0:ÿvg.&lt;: 000000B0 FF 72 38 3A FF 70 26 7A FF 6E 60 00 00 B4 3C 2D ÿr8:ÿp&amp;zÿn\`..´&lt;- 000000C0 00 0A 38 2D 00 08 D8 6D 00 06 26 7A FF 5E 61 00 ..8-..Øm..&amp;zÿ^a. 000000D0 00 B0 66 00 00 AA 20 4C 30 2D 00 06 E1 48 E3 48 .°f..ª L0-..áHãH 000000E0 41 F0 00 00 43 FA FF 48 90 FC 00 20 B1 CC 6D 00 Að..CúÿH.ü. ±Ìm. 000000F0 00 8E 70 0A 12 30 00 00 B2 31 00 00 66 EA 51 C8 .Žp..0..²1..fêQÈ 00000100 FF F4 7E 00 1E 28 00 1B E1 4F 1E 28 00 1A 2C 7A ÿô~..(..áO.(..,z 00000110 FF 1A 26 7A FF 12 42 84 0C 47 0F F0 6C 52 36 07 ÿ.&amp;zÿ.B„.G.ðlR6. 00000120 55 43 C6 ED 00 02 D6 6D 00 0C 0C 44 00 40 6C 08 UCÆí..Öm...D.@l. 00000130 4A 44 67 0E B6 45 67 10 61 46 66 42 E1 8C E3 8C JDg.¶Eg.aFfBáŒãŒ 00000140 D7 C4 3C 03 3A 03 42 84 D8 6D 00 02 DA 6D 00 02 ×Ä&lt;.:.B„Øm..Úm.. 00000150 34 07 E2 4A D4 47 12 36 20 01 E1 49 12 36 20 00 4.JÔG.6 .áI.6 . 00000160 08 07 00 00 67 02 E8 49 02 41 0F FF 3E 01 60 A8 ....g.èI.A.ÿ&gt;.\`¨ 00000170 4A 44 67 04 61 0A 66 06 2F 3A FE AC 4E 75 60 FE JDg.a.f./:þ¬Nu\`þ 00000180 3F 39 00 00 04 46 3F 06 3F 04 2F 0B 42 67 3F 3C ?9...F?.?./.Bg?&lt; 00000190 00 04 4E 4D DE FC 00 0E 4A 40 4E 75 00 00 00 00 ..NMÞü..J@Nu.... 000001A0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 000001B0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 000001C0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 000001D0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 000001E0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 000001F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 24 7D ..............$}
</span></span></code></pre></td></tr></table></div></div><p>Detailed content of the boot sector:</p><p>Offset</p><p>Size</p><p>Values</p><p>Notes</p><p>000</p><p>2</p><p>60 38</p><p>BRA.S instruction to branch to the loader code at offset $3A ($38 bytes forward).</p><p>002</p><p>6</p><p>4C 6F 61 64 65 72 (&lsquo;Loader&rsquo; string)</p><p>008</p><p>3</p><p>00 00 00</p><p>Volume serial number.</p><p>00B</p><p>2</p><p>00 02 (512)</p><p>Number of bytes per sector (Little endian word).</p><p>00D</p><p>1</p><p>02 (2)</p><p>Number of sectors per cluster.</p><p>00E</p><p>2</p><p>01 00 (1)</p><p>Number of reserved sectors (Little endian word).</p><p>010</p><p>1</p><p>02 (2)</p><p>Number of File Allocation Tables (FAT).</p><p>011</p><p>2</p><p>10 00 (16)</p><p>Number of entries in the root directory (Little endian word). Each entry is 32 bytes so 16 entries occupy exactly a sector (512 bytes).</p><p>013</p><p>2</p><p>24 03 (804)</p><p>Number of sectors on media. This number of sectors is incorrect and should be 800 (80 tracks of 10 sectors).</p><p>015</p><p>1</p><p>F8</p><p>Media descriptor.</p><p>016</p><p>2</p><p>02 00 (2)</p><p>Number of sectors per FAT (Little endian word).</p><p>018</p><p>2</p><p>0A 00 (10)</p><p>Number of sectors per track (Little endian word).</p><p>01A</p><p>2</p><p>01 00 (1)</p><p>Number of sides on media (Little endian word).</p><p>01C</p><p>2</p><p>00 00 (0)</p><p>Number of hidden sectors (Little endian word).</p><p>01E</p><p>2</p><p>00 00 (0)</p><p>A word value that is copied to the system variable named &lsquo;_cmdload&rsquo; (Big endian word).</p><p>020</p><p>2</p><p>00 00 (0)</p><p>Load mode (Big endian word). 0 instructs the loader to load a file by its name and using the filesystem. Other values instruct the loader to load a sequence of sectors without refering to the filesystem.</p><p>022</p><p>2</p><p>00 00 (0)</p><p>First sector to read (Big endian word). Only used when Load mode is not 0.</p><p>024</p><p>2</p><p>00 00 (0)</p><p>Number of sectors to read (Big endian word). Only used when Load mode is not 0.</p><p>026</p><p>4</p><p>00 04 00 00</p><p>Load address (Big endian double word). Memory address where the file or sectors will be loaded.</p><p>02A</p><p>4</p><p>00 00 00 00</p><p>FAT address (Big endian double word). Memory address where the FAT and root directory data will be loaded. The value $00000000 will automatically select an appropriate address.</p><p>02E</p><p>11</p><p>53 57 4F 4F 53 48 20 20 49 4D 47 &lsquo;SWOOSH  IMG&rsquo; string.</p><p>File name and extension (8.3 name without the &lsquo;.&rsquo;). Only used when Load mode is 0.</p><p>039</p><p>1</p><p>00</p><p>Reserved.</p><p>03A</p><p>n</p><p>-</p><p>Boot code (padded with 00 bytes at the end to fill the whole sector).</p><p>1FE</p><p>2</p><p>24 7D</p><p>Word value computed so that the checksum of the boot sector is $1234.</p><h4 id=track-0-sectors-2-to-6-file-system>Track 0, Sectors 2 to 6: File system</h4><p>The floppy disk is formatted using the FAT12 file system that is used on standard Atari ST floppy disks. The same file system is used on IBM PC floppy disks.<br>FAT file systems manage disk space in logical chunks called &lsquo;clusters&rsquo;. A cluster is a set of one or more sectors.<br>Each file on the disk is stored in one or more clusters. A cluster is only affected to one file at a time which means that there can be unused (wasted) space at the end of a cluster.<br>There is a directory structure that contains an entry for each file. Such an entry stores the file name, the size, the date and time of last modification and the ID of the first cluster used by the file. The other clusters used by the file can be determined by parsing the FAT which is a table with an entry for each cluster on the disk. Each entry in this table contains either the ID of the next cluster of the file, or a special value marking the last cluster of the file.<br>For robustness, the FAT is duplicated on two separate locations on the disk to ensure that files can be read even if one sector used to store the FAT itself becomes unreadable.<br>On the Dungeon Master and Chaos Strikes Back for Atari ST floppy disks:<br>Sectors 2 and 3 store the first FAT<br>Sectors 4 and 5 store the second FAT (an exact copy of the first FAT)<br>Sector 6 stores the root directory. There can be 16 entries (16 files) in the root directory.</p><p>Here is a list of the files that can be found on all versions of the games:</p><p>File name</p><p>Clusters used</p><p>Size and Date/Time</p><p>DM 1.0 EN<br>(1987-12-08)</p><p>DM 1.0 EN<br>(1987-12-11)</p><p>DM 1.1 EN</p><p>DM 1.2 EN</p><p>DM 1.2 GE</p><p>DM 1.3 FR</p><p>CSB 2.0 EN</p><p>CSB 2.1 EN</p><p>BOOTER</p><p>002</p><p>1024</p><p>1024</p><p>1024</p><p>1024</p><p>1024</p><p>1024</p><p>1024</p><p>1024</p><p>08-12-87<br>12:34 pm</p><p>11-12-87<br>11:52 am</p><p>07-01-88<br>08:53 pm</p><p>31-12-99<br>04:54 pm</p><p>31-12-99<br>04:56 pm</p><p>20-11-85<br>12:04 am</p><p>31-12-99<br>04:54 pm</p><p>31-12-99<br>04:54 pm</p><p>SWOOSH.IMG</p><p>003-005</p><p>3016</p><p>3016</p><p>3016</p><p>3016</p><p>3016</p><p>3016</p><p>3016</p><p>3016</p><p>08-12-87<br>12:34 pm</p><p>11-12-87<br>11:52 am</p><p>07-01-88<br>08:54 pm</p><p>31-12-99<br>04:54 pm</p><p>31-12-99<br>04:56 pm</p><p>20-11-85<br>12:04 am</p><p>31-12-99<br>04:54 pm</p><p>31-12-99<br>04:54 pm</p><p>START.PRG</p><p>006</p><p>770</p><p>770</p><p>770</p><p>770</p><p>770</p><p>770</p><p>770</p><p>770</p><p>08-12-87<br>12:34 pm</p><p>11-12-87<br>11:52 am</p><p>07-01-88<br>08:54 pm</p><p>31-12-99<br>04:55 pm</p><p>31-12-99<br>04:56 pm</p><p>20-11-85<br>12:04 am</p><p>31-12-99<br>04:55 pm</p><p>31-12-99<br>04:55 pm</p><p>GRAPHICS.DAT</p><p>007-272</p><p>271911</p><p>271918</p><p>271917</p><p>271918</p><p>272288</p><p>271995</p><p>272069</p><p>272069</p><p>08-12-87<br>12:34 am</p><p>11-12-87<br>02:51 pm</p><p>07-01-88<br>09:01 pm</p><p>18-02-88<br>12:18 am</p><p>01-03-88<br>11:36 am</p><p>20-05-88<br>06:03 pm</p><p>15-11-89<br>12:00 am</p><p>15-11-89<br>12:00 am</p><p>START.PAK</p><p>273-365 (DM)<br>273-368 (CSB)<br>372 (CSB 2.1)</p><p>95180</p><p>95226</p><p>95012</p><p>95148</p><p>95202</p><p>95208</p><p>97712</p><p>98516</p><p>08-12-87<br>09:19 pm</p><p>11-12-87<br>03:10 pm</p><p>08-01-88<br>04:30 pm</p><p>24-02-88<br>05:06 pm</p><p>24-02-88<br>04:05 pm</p><p>20-05-88<br>06:04 pm</p><p>15-11-89<br>03:59 am</p><p>08-01-90<br>01:25 pm</p><p>DUNGEON.DAT</p><p>366-398 (DM)<br>369-371 (CSB)</p><p>33286</p><p>33314</p><p>33442</p><p>33442</p><p>33792</p><p>33774</p><p>2098</p><p>2098</p><p>08-12-87<br>06:23 am</p><p>11-12-87<br>02:10 pm</p><p>07-01-88<br>08:47 pm</p><p>01-03-88<br>11:04 am</p><p>01-03-88<br>11:37 am</p><p>20-05-88<br>06:05 pm</p><p>22-04-87<br>04:17 am</p><p>22-04-87<br>04:17 am</p><p>Notes:</p><ul><li>These floppy disks were produced in 1987-1988, yet some files have their dates set to 31-12-99 or 20-11-85!</li><li>On the floppy disk of Dungeon Master for Atari ST version 1.0 English (1987-12-08), the root directory contains an additional entry for a deleted file (a previous version of the START.PAK file):<br>Name: &lt;$E5>TART.PAK (the first character in the name being replaced by the hexadecimal value $E5 means that the file was deleted)<br>Size: 0 (all the clusters are used by other files)<br>Date/Time: 08-12-87 09:19 pm</li><li>The SWOOSH.IMG file is identical on all the floppy disks listed in the table above, as well as on the Chaos Strikes Back Utility Disk.</li><li>The START.PRG file is identical on all the floppy disks listed in the table above, but different from the one found on the Chaos Strikes Back Utility Disk.</li></ul><h4 id=track-0-sector-7-serial-number-and-protection-with-fuzzy-bits>Track 0, Sector 7: Serial number and protection with fuzzy bits</h4><h5 id=serial-number>Serial number</h5><p>On all the floppy disks that have been studied in the making of this document, there are three bytes that are different in each version, making each copy of the games really <em>unique</em>. These unique bytes probably form a serial number (because they are preceded by the ASCII string &lsquo;Seri&rsquo;) and were probably included during disk duplication when the games were manufactured in the hope that a pirated copy could be more easily identified and located. These three bytes are located at offsets $0D, $0E and $11. The bytes at offsets $0F and $10 may be part of the serial number, but their values are always 00 00 in the disks that were studied. The first 4 bytes may form a little endian 32 bit integer. Here are the values that were found (offsets $0D to $11):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>9A 03 00 00 B4 Dungeon Master version 1.0 English (1987-12-08) 8F 09 00 00 AB Dungeon Master version 1.0 English (1987-12-11) 61 03 00 00 4F Dungeon Master version 1.1 English 81 04 00 00 48 Dungeon Master version 1.2 English 75 00 00 00 58 Dungeon Master version 1.2 English CA 08 00 00 EF Dungeon Master version 1.2 English 24 12 00 00 1B Dungeon Master version 1.2 German F7 09 00 00 D3 Dungeon Master version 1.3 French AF 01 00 00 83 Dungeon Master version 1.3 French 3E 0E 00 00 1D Dungeon Master version 1.3 French 9A 03 00 00 B4 Chaos Strikes Back version 2.0 English C9 04 00 00 E0 Chaos Strikes Back version 2.0 English 87 02 00 00 A8 Chaos Strikes Back version 2.0 English 35 00 00 00 18 Chaos Strikes Back version 2.1 English CB 03 00 00 E5 Chaos Strikes Back version 2.1 English
</span></span></code></pre></td></tr></table></div></div><h5 id=fuzzy-bits>Fuzzy bits</h5><p>This sector is most interesting because it contains &lsquo;fuzzy bits&rsquo;. A fuzzy bit is a bit whose value seems to be random: if you read the same bit of data several times, the value will sometimes be &lsquo;0&rsquo; and it will sometimes be &lsquo;1&rsquo;. There are several ways to create fuzzy bits on a floppy disk and they all require the use of special hardware. The floppy disk controller in the Atari ST cannot create them. This is the reason why they are useful as a copy protection mechanism: if you try to copy a sector containing fuzzy bits on a regular Atari ST, the written data will not contain fuzzy bits anymore and will only reflect the bits as they were read when the copy was made. The program can check whether the floppy disk is an original by reading this sector several times and comparing the results. If the value of some bits is different across multiple read operations, then the disk is an original. But if all read operations produce the same result, then the disk is a copy.<br>Using this method, it is fairly easy to write a program to detect fuzzy bits. However with the standard FDC in the Atari ST it is not possible to analyse how these fuzzy bits are produced: it is only possible to detect the symptom (bits with random values) but not what causes them.</p><p>In order to find out how this works, DrCoolZic performed a very detailed analysis of track 0 on the floppy disk. This was done on an Atari ST equipped with a &lsquo;Discovery Cartridge&rsquo; which is a hardware add-on containing a much more advanced floppy disk controller than the built-in one.</p><ol><li>Using the Discovery Cartridge, he made a complete recording of the lowest possible level of information coming from the floppy disk: all the flux reversals on track 0 including the accurate timing between each pair of flux reversals. This high precision record represents the output signal coming out from the floppy disk drive when reading the track. This signal enters the floppy disk controller where the electronics tries to extract meaningful information (the stream of data bits) from the signal.</li><li>The recording was transfered to a PC where it was processed by an &lsquo;Analyze&rsquo; program written by DrCoolZic. This program reproduces in software the behavior of the standard Atari ST floppy disk controller with high precision, including the PLL synchronization process.</li><li>A first analysis of the sector&rsquo;s content shows that there are no MFM timing violations: consecutive flux reversals are always separated by at least one 0 bit and at most three 0 bits.</li><li>A closer analysis of timings shows that some bit cells on the floppy disk do not have normal sizes. This is what causes the fuzzy bits.</li></ol><p>The MFM encoding ensures that between two bit cells containing flux reversals (two &lsquo;1&rsquo; bits) there are at least one and at most three bit cells without flux reversals (&lsquo;0&rsquo; bits). With the standard MFM bit cell being 2µs, it means that two consecutive flux reversals can be spaced only by 4µs, 6µs or 8µs. These three possible patterns are represented on figure 2.<br>Or course, depending on the drive speed and other factors, there can be slight variations on these values. The role of the PLL in the FDC is to constantly adapt the inspection window to these variations. The size of the window is adjusted based on the frequency of the flux reversals encountered in the input signal. The position of the window (also called the phase) is adjusted so that flux reversals occur in the middle of the inspection window. Only a few flux reversals are needed for the PLL to be fully synchronized.</p><p>Here is a graphic representation of track 0 of the Chaos Strikes Back version 2.1 for Atari ST game disk:<br><strong>Figure 3</strong><br><a class=link href=http://dmweb.free.fr/files/Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0_Screenshot.png title=Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0_Screenshot.png target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0_ScreenshotThumbnail.png loading=lazy alt=Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0_Screenshot.png></a></p><p>It was generated by <a class=link href=http://info-coach.fr/atari/software/pc-projects/Aufit.php target=_blank rel=noopener>Aufit</a> from track data captured with <a class=link href=http://www.kryoflux.com/ target=_blank rel=noopener>Kryoflux</a>. Each point on this graphic represents a flux transition. The X axis represents the time in milliseconds when the flux transition occurred, starting at 0 at the beginning of the track reading. As the floppy disk rotates at about 300 rotations per minute = 5 rotations per second, reading a full track takes approximately 200ms. The Y axis represents the time since the previous flux transition occurred, in microseconds. You can see that most flux transitions occur around 4µs, 6µs or 8µs after the previous one, just as required by the MFM encoding. This is true for all sectors except sector 7 which contains a lot of flux transitions with abnormal timings between 4µs and 6µs. Here is a graphic representing only sector 7 and only the area between 4µs and 6µs:<br><strong>Figure 4</strong><br><a class=link href=http://dmweb.free.fr/files/Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0.Sector.7_Screenshot.png title=Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0.Sector.7_Screenshot.png target=_blank rel=noopener><img src=http://dmweb.free.fr/files/thumbnails/Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0.Sector.7_ScreenshotThumbnail.png loading=lazy alt=Game_Chaos.Strikes.Back_UK_Version.2.1.Track.0.Sector.7_Screenshot.png></a></p><p>When the PLL is synchronized, if a flux reversal is not correctly placed and occurs at the very border of the inspection window (1µs sooner or later than the &lsquo;perfect&rsquo; expected timing), then the PLL gets confused and outputs a random value:</p><ul><li>If the flux reversal is detected right before the end of the inspection window, then the output bit will be &lsquo;1&rsquo;. The next bit will be &lsquo;0&rsquo; because there cannot be two consecutive &lsquo;1&rsquo; bits.</li><li>If the flux reversal is not detected before the end of the inspection window, then the output bit will be &lsquo;0&rsquo;. The flux reversal will be detected at the very beginning of the next inspection window, so that the next output bit will be &lsquo;1&rsquo;.</li></ul><p>Note that the misplaced flux reversal is never missed: the FDC just cannot reliably determine which bit cell it is part of, hence the random result.</p><p>In order to create this fuzzy bit effect, one way is to put flux reversals right on the edge of the PLL&rsquo;s inspection window. For example instead of the standard timings of 4µs or 6µs between two flux reversals, an uncertain flux reversal could be written exactly 5µs after the previous flux reversal. The PLL compensates for variations in the disk rotation speed (it may be different from one drive to another or from one rotation to the next), however smaller instantaneous variations can occur during one rotation of the disk. These small variations are responsible for the appearance of the fuzzy bits: the uncertain flux reversals will not always be detected in the same bit cell.<br>In order to maximize the probability of having fuzzy bits detected, the copy protection relies on the very special timing pattern as seen on figure 4. The pattern used in Dungeon Master and Chaos Strikes Back has timings between transition pairs that are slowly increasing from 4µs to 5.5µs and decreasing from 6µs to 4.5µs in small 0.1µs increments so that there will always be some ambiguous transitions right on the edge of inspection windows. Note that the total time for two consecutive transitions is always around 10µs, just as it would have been if normal timings were used (with pairs of 4µs and 6µs transitions).</p><p>Here is the sector data as it was most probably defined when being written by the disk duplicator (this is only a guess, but it is validated by the fact that the CRC value for this sector data matches the one found on the original disk in the sector header field):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 07 50 41 43 45 2F 46 42 09 53 65 72 69 CA 08 00 .PACE/FB.SeriÊ.. 00000010 00 EF E9 01 68 68 68 68 68 68 68 68 68 68 68 68 .ïé.hhhhhhhhhhhh 00000020 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000030 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000040 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000050 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000060 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000070 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000080 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000090 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000A0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000B0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000C0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000D0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000E0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000F0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000100 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000110 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000120 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000130 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000140 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000150 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000160 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000170 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000180 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 00000190 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001A0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001B0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001C0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001D0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001E0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000001F0 68 68 68 68 68 68 68 68 68 68 68 68 68 AC 46 42 hhhhhhhhhhhhh¬FB
</span></span></code></pre></td></tr></table></div></div><p>Note that the duplicator needed additional information about the exact timings to use to record this sector, instead of using the standard timings. The use of carefully chosen custom timings while writing this sector is the real cause of the fuzzy bits. Look at the sector data as it is read from the floppy disk (this is only one example: each read operation would return a slightly different result because of the fuzzy bits producing random values):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 07 50 41 43 45 2f 46 42 09 53 65 72 69 ca 08 00 .PACE/FB.Seri... 00000010 00 ef e9 01 68 68 68 68 68 68 68 68 68 68 e8 e8 ....hhhhhhhhhh.. 00000020 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 .........hhhhhhh 00000030 68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8 e8 hhhhhhhhhhhh.... 00000040 e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68 .......hhhhhhhhh 00000050 68 68 68 68 68 68 68 68 68 68 e8 e8 68 e8 e8 e8 hhhhhhhhhh..h... 00000060 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68 68 ......hhhhhhhhhh 00000070 68 68 68 68 68 68 68 68 e8 e8 68 e8 e8 e8 e8 e8 hhhhhhhh..h..... 00000080 e8 68 e8 e8 e8 68 68 68 68 68 68 68 68 68 68 68 .h...hhhhhhhhhhh 00000090 68 68 68 68 68 68 e8 e8 68 e8 e8 e8 e8 e8 e8 e8 hhhhhh..h....... 000000A0 e8 68 68 e8 68 68 68 68 68 68 68 68 68 68 68 68 .hh.hhhhhhhhhhhh 000000B0 68 68 68 68 68 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 hhhhhh.........h 000000C0 68 e8 68 68 68 68 68 68 68 68 68 68 68 68 68 68 h.hhhhhhhhhhhhhh 000000D0 68 e8 68 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 h.hh..........hh 000000E0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 hhhhhhhhhhhhhhhh 000000F0 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68 68 68 ..........hh.hhh 00000100 68 68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8 hhhhhhhhhhhhh... 00000110 68 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68 68 68 68 68 h.......hh.hhhhh 00000120 68 68 68 68 68 68 68 68 68 68 68 68 e8 e8 e8 68 hhhhhhhhhhhh...h 00000130 e8 e8 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 ........hhhhhhhh 00000140 68 68 68 68 68 68 68 68 68 68 68 e8 e8 68 e8 e8 hhhhhhhhhhh..h.. 00000150 e8 e8 e8 e8 e8 e8 68 68 68 68 68 68 68 68 68 68 ......hhhhhhhhhh 00000160 68 68 68 68 68 68 68 e8 68 68 e8 e8 e8 e8 e8 e8 hhhhhhh.hh...... 00000170 e8 e8 68 68 e8 68 68 68 68 68 68 68 68 68 68 68 ..hh.hhhhhhhhhhh 00000180 68 68 68 68 68 e8 68 68 e8 e8 e8 e8 e8 e8 e8 e8 hhhhh.hh........ 00000190 68 68 e8 68 68 68 68 68 68 68 68 68 68 68 68 68 hh.hhhhhhhhhhhhh 000001A0 68 68 68 68 68 68 e8 e8 e8 e8 e8 e8 e8 e8 68 68 hhhhhh........hh 000001B0 e8 e8 68 68 68 68 68 68 68 68 68 68 68 68 68 68 ..hhhhhhhhhhhhhh 000001C0 68 e8 e8 68 68 e8 e8 e8 e8 e8 e8 e8 68 68 e8 68 h..hh.......hh.h 000001D0 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 e8 hhhhhhhhhhhhhhh. 000001E0 e8 68 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 e8 68 68 68 .h...........hhh 000001F0 68 68 68 68 68 68 68 68 68 68 68 68 68 ac 46 42 hhhhhhhhhhhhh.FB
</span></span></code></pre></td></tr></table></div></div><p>As you can see, many 68h bytes have been transformed to E8h bytes. Here is what happens at binary level:<br>Two consecutive 68h bytes, along with their MFM representation:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 0 1 1 0 1 0 0 0 0 1 1 0 1 0 0 0 MFM 001010001001010**_1 0_**010100010010101
</span></span></code></pre></td></tr></table></div></div><p>When the fuzzy bit effect takes place, the clock bit between the two bytes of data and the first data bit of the second byte are swapped:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 0 1 1 0 1 0 0 0 1 1 1 0 1 0 0 0 MFM 001010001001010**_0 1_**010100010010101
</span></span></code></pre></td></tr></table></div></div><p>The hexadecimal value of the second byte then becomes E8h.</p><p>This sector with fuzzy bits is also found on the Chaos Strikes Back for Atari ST Utility Disk.<br>The game disks of all Amiga versions of Dungeon Master and Chaos Strikes Back (except Dungeon Master version 3.6) also contain this sector in a dedicated track using an Atari ST format. Other sectors in this track are not used. All other tracks use the regular Amiga format. The Amiga versions of the Chaos Strikes Back Utility Disk do not contain this sector.</p><h4 id=track-0-sector-247-protection-with-a-non-standard-sector-number>Track 0, Sector 247: Protection with a non standard sector number</h4><p>This sector is identical in all versions of Dungeon Master and Chaos Strikes Back for Atari ST.<br>In the sector header field of the eighth sector of track 0, the sector number specified is 247 ($F7) instead of the expected value 8.<br>Having a sector number which is not in line with other sectors is not a problem by itself. This sector can be read as any other sector as long as you give the FDC the correct sector number to read, which is 247. This may cause trouble to many programs because they will try to read sectors numbered from 1 to 10 and they will fail in reading sector number 8 because there is no such sector on the track. It is also quite easy to write a sector with pretty much any number while formating the track (writing the whole track at once). However, $F7 (and a few other values) is a sector number that cannot be written by the standard floppy disk controller in the Atari ST computer. This value is interpreted as a special command by the FDC when it formats the track and thus this value cannot be written to the disk in a sector header field. It means that a disk copy made on a standard Atari ST cannot have this value correctly copied. Only special equipment can be used to write this value in the sector header. This provides a copy protection mechanism as it cannot be reproduced on a standard Atari ST computer.</p><p>There is nothing special with the contents of this sector data field. The protection relies only on the special sector number in the header field.<br>Here is an hexadecimal dump of the data in this sector:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Offset(h) 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 00000000 43 6F 70 79 72 69 67 68 74 20 28 63 29 20 31 39 Copyright (c) 19 00000010 38 37 2C 20 53 6F 66 74 77 61 72 65 20 48 65 61 87, Software Hea 00000020 76 65 6E 2C 20 49 6E 63 2E 00 FF FF FF FF FF FF ven, Inc..ÿÿÿÿÿÿ 00000030 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000040 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000050 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000060 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000070 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000080 44 75 6E 67 65 6F 6E 4D 61 73 74 65 72 00 FF FF DungeonMaster.ÿÿ 00000090 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000A0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000B0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000C0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000D0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000E0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000000F0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000100 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000110 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000120 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000130 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000140 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000150 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000160 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000170 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000180 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 00000190 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001A0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001B0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001C0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001D0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001E0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ 000001F0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF 9C 9C ÿÿÿÿÿÿÿÿÿÿÿÿÿÿœœ
</span></span></code></pre></td></tr></table></div></div><h3 id=description-of-the-boot-process>Description of the boot process</h3><ol><li>The Atari ST BIOS loads the boot sector from the floppy disk to memory.</li><li>After checking that the boot sector is executable (by computing a checksum), the boot sector code is executed.</li><li>The boot sector code loads the SWOOSH.IMG file in memory and starts execution of this program.</li><li>SWOOSH.IMG displays the FTL logo (using a palette animation technique to simulate the logo animation) and plays the associated sound effect by using the Programmable Sound Generator (PSG). It then makes a BIOS call to run START.PRG with the &lsquo;AUTO&rsquo; command line parameter. The program will not start without this parameter, this is another simple protection.</li><li>START.PRG is a small program that reads the compressed main program from the START.PAK file and uncompresses it to memory. The main program, which follows the standard Atari ST .PRG format, is then executed from memory.</li></ol><h3 id=references>References</h3><p><a class=link href=http://dmweb.free.fr/files/Atari-Copy-Protection-V1.4.pdf title=Atari-Copy-Protection-V1.4.pdf target=_blank rel=noopener><img src=http://dmweb.free.fr/sites/all/modules/dmwebmodule/IconPDF.png loading=lazy alt=Atari-Copy-Protection-V1.4.pdf> Atari-Copy-Protection-V1.4.pdf</a></p><p>This document by DrCoolZic describes all the copy protection schemes that were used on Atari ST. Its content about Dungeon Master was the basis for this web page. It also describes the custom tools written by the author to analyze the copy protections.</p><p><a class=link href=http://dmweb.free.fr/files/TechDoc-DM-AtariST-FloppyDiskAnalysis.zip title=TechDoc-DM-AtariST-FloppyDiskAnalysis.zip target=_blank rel=noopener><img src=http://dmweb.free.fr/sites/all/modules/dmwebmodule/IconArchive.png loading=lazy alt=TechDoc-DM-AtariST-FloppyDiskAnalysis.zip> TechDoc-DM-AtariST-FloppyDiskAnalysis.zip</a></p><p>This archive contains the complete results of DrCoolZic&rsquo;s tools when run against a floppy disk of Dungeon Master for Atari ST version 1.2 English. These files were kindly produced for me by DrCoolZic. Please read the PDF document above to better understand their contents.</p><h3 id=credits>Credits</h3><p>Jean Louis-Guérin (DrCoolZic) for his detailed analysis of the original floppy disk as shown in his great document about the many copy protection schemes that were used by Atari ST games, and for the help he gave me in writing this article.</p><h3 id=history-of-this-document>History of this document</h3><p>Version 1.2, July 18, 2015</p><p>Added graphics and description of flux transition timings for track 0, sector 7.</p><p>Version 1.1, February 14, 2009</p><p>Minor edits.</p><p>The Fuzzy Bits section was updated with a better explanation. Thanks to Jean Louis-Guérin for his help.</p><p>Version 1.0, January 25, 2009</p><p>First release.</p><p>from Hacker News <a class=link href=https://ift.tt/2nChNmk target=_blank rel=noopener>https://ift.tt/2nChNmk</a></p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 ZYChimne</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#overview>Overview</a></li><li><a href=#technical-background>Technical background</a><ol><li><a href=#some-definitions>Some definitions</a></li><li><a href=#organizing-data-on-the-disk>Organizing data on the disk</a></li><li><a href=#storing-binary-data-using-magnetic-states>Storing binary data using magnetic states</a></li><li><a href=#reading-and-writing-data>Reading and writing data</a></li><li><a href=#encoding-data>Encoding data</a></li><li><a href=#synchronizing-the-fdc>Synchronizing the FDC</a></li><li><a href=#separating-data-bits-and-clock-bits>Separating data bits and clock bits</a></li><li><a href=#track-layout>Track layout</a></li><li><a href=#floppy-disk-formats>Floppy disk formats</a></li></ol></li><li><a href=#detailed-structure-of-the-games-floppy-disk>Detailed structure of the games&rsquo; floppy disk</a><ol><li><a href=#general-layout>General layout</a></li><li><a href=#track-0-sector-1-boot-sector>Track 0, Sector 1: Boot sector</a></li><li><a href=#track-0-sectors-2-to-6-file-system>Track 0, Sectors 2 to 6: File system</a></li><li><a href=#track-0-sector-7-serial-number-and-protection-with-fuzzy-bits>Track 0, Sector 7: Serial number and protection with fuzzy bits</a></li><li><a href=#track-0-sector-247-protection-with-a-non-standard-sector-number>Track 0, Sector 247: Protection with a non standard sector number</a></li></ol></li><li><a href=#description-of-the-boot-process>Description of the boot process</a></li><li><a href=#references>References</a></li><li><a href=#credits>Credits</a></li><li><a href=#history-of-this-document>History of this document</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>